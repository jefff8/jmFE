<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>江门建筑管理系统</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" href="../css/mui.min.css">	
		<link rel="stylesheet" href="../css/my_css.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<style type="text/css">
			.mui-control-content {				
				bottom: 0px;	
			}
			/*媒体查询，横屏效果*/
			@media only screen and (orientation:landscape ) {
				.mui-control-content {
					bottom: 0px;
					}			
			}
			html,
			body,
			.mui-content {
				height: 0px;
				margin: 0px;
				background-color: #efeff4;
			}
			.mui-control-content {				
				bottom: 0px;	
			}
			h5.mui-content-padded {
				margin-left: 3px;
				margin-top: 20px !important;
			}
			h5.mui-content-padded:first-child {
				margin-top: 12px !important;
			}
			.mui-btn {
				font-size: 16px;
				padding: 8px;
				margin: 3px;
			}
			.ui-alert {
				text-align: center;
				padding: 20px 10px;
				font-size: 16px;
			}
			* {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
			}
			.btn_size{
				background:#0000FF;
				color: white;
			}
			#floorTab{
				text-align: center;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">分户验收申请</h1>
		</header>
		<div class="mui-content">
			
		    <div class="mui-content-padded">
				<form class="mui-input-group">
				    <div class="mui-input-row">
				        <label>栋号:</label>
				        <input type="text" id="buildingNum"  class="mui-input-clear" placeholder="请输入栋号"  >
				    </div>
				    <div class="mui-input-row">
				        <label>楼层:</label>
				        <input type="number" id="floor" class="mui-input-clear" placeholder="请输入楼层"  >
				    </div>
				    <div class="mui-input-row">
				        <label>户数:</label>
				        <input type="number" id="households" class="mui-input-clear" placeholder="请输入户数"  >
				    </div>
				    <div class="mui-input-row">
				        <label>起始层:</label>
				        <input type="number" id="beginFloor" class="mui-input-clear" placeholder="请输入起始层" value="1" >
				    </div>
				    <div class="mui-input-row">
				        <label>验收时间:</label>
				        <input type="text" id="acceptanceTime" class="mui-input-clear" placeholder="请选择验收时间"  readonly="readonly" >
				    </div>
				</form>
				&nbsp;
				<button id="sure" type="button" class="mui-btn mui-btn-primary mui-btn-block" >确定</button>
			<div id="tabContent">
				<div id="floorTab">
					<!--<button id="houseNum">A101</button>
					<button id="houseNum">A102</button>
					<button id="houseNum">A103</button>
					<button id="houseNum">A104</button>-->
					<!--<button>A201</button>
					<button>A202</button>
					<button>A203</button>
					<button>A101</button>
					<button>A102</button>
					<button>A103</button>
					<button>A104</button>
					<button>A201</button>
					<button>A202</button>
					<button>A203</button> -->
				</div>
		    </div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/service.js"></script>
		<script type="text/javascript">
			mui.init({
				gestureConfig:{					
					longtap: true, //长按默认为false
					doubletap: true
				}
			});
			mui.plusReady(function(){
				//获取传值 
				var self = plus.webview.currentWebview();
				pj_name = self.pj_name;//工程名称
				pj_timestamp = self.pj_timestamp;//工程时间戳
				var doc = document;
				var sureButton = doc.getElementById("sure");
				var tabContent = doc.getElementById("tabContent");
				var buildingNum = doc.getElementById("buildingNum");
				var floor = doc.getElementById("floor");
				var households = doc.getElementById("households");
				var beginFloor = doc.getElementById("beginFloor");
				var acceptanceTime = doc.getElementById("acceptanceTime");
				var myDate=new Date();
				var mytime=myDate.getTime();//当前时间戳 
				//验收时间日期选择器
				acceptanceTime.addEventListener('tap',function(){
					plus.nativeUI.pickDate( function(e){
						d=e.date;
		                acceptanceTime.value = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
				   });
				});
				//确定按钮
				sureButton.addEventListener('tap',function(){
					var allHouse = '';
					//所有户数添加
					for(var i=beginFloor.value;i<=floor.value;i++){
						for(var j=1;j<=households.value;j++){
							allHouse += buildingNum.value + i + '0' + j +'|';
						}
					}
					allHouse = allHouse.substring(0,allHouse.length-1);
					mui.ajax(url+'my_household/household_list.php',{
						data:{
							flag:'add',
							buildingNum:buildingNum.value,
							floor:floor.value,
							households:households.value,
							beginFloor:beginFloor.value,
							pj_name:pj_name,
							pj_timestamp:pj_timestamp,
							acceptanceTime:acceptanceTime.value,
							mytime:mytime,
							allHouse:allHouse
						},
						type:'post',
						dataType:'json',
						timeout:10000,
						success:function(data){
								var target=plus.webview.getWebviewById('../my_household/household_list.html');
								target.reload(true);
								mui.toast('保存成功！',{ duration:'long', type:'div' });
						},
						error:function(xhr,type,errorThrown){
							alert('ajax错误'+type+'---'+errorThrown+"失败！");
						}
					});
//					ShowTab(buildingNum,floor,households,beginFloor);
				});
				
				//显示表格
				function ShowTab(buildingNum,floor,households,beginFloor){
					var floorTab = document.getElementById("floorTab");
					floorTab.innerHTML = "";
					var btnId = 0;
					for(var i=beginFloor;i<=floor;i++){
						for(var j=1;j<=households;j++){
							var newButton = document.createElement('button');
							var textNode = document.createTextNode(buildingNum+i+'0'+j);
							newButton.id = 'button'+btnId;
							newButton.style.cssText = "margin:2px;width:60px;height:60px;";
							newButton.appendChild(textNode);
							floorTab.appendChild(newButton);
							btnId++;
						}
					}
					
				}
				mui("#floorTab").on('longtap','button',function(){
					alert(this.id);
				});
			});
		</script>
	</body>
</html>