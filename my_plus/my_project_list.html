<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>江门建筑管理系统</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/my_css.css">
		<style type="text/css">
			.margintop10px {
				margin-top: 10px;
			}
			
			.paddingleft34px { 
				padding-left: 34px;
			}
			
			.mui-popover {
				height: 260px;
			}
			
			#cdbzPopover {
				min-width: 282px;
				top: 15% !important;
				margin-top: 0px;
				left: 50% !important;
				margin-left: -141px;
				position: fixed;
			}
			
			.mui-popover .mui-popover-arrow {
				display: none !important;
			}
		</style>
	</head>
	

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-icon mui-icon-left-nav mui-pull-left" onclick="back()"></a>
		    <h1 id="refresh" class="mui-title">我的工程</h1>
		</header>
		<div id="gongcheng" class="mui-content">
			
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/service.js" ></script>
		<script type="text/javascript">
			mui.init({
				gestureConfig:{					
						doubletap: true
					}
			});
			var refresh = document.getElementById("refresh");
				//监听标题栏的双击事件(刷新页面)
				refresh.addEventListener('doubletap',function () {
					window.location.reload();
			});
			mui.plusReady(function(){
				//获取url参数值
				function geturl(name){
					var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
					var r = window.location.search.substr(1).match(reg);
					if(r!=null)return  unescape(r[2]);
					return null;
				}
				uid = geturl("uid");
				main =plus.webview.currentWebview().opener();
				//动态创建函数
				function myproject(id,timestamp,gcmc,dq,i,construction,supervision,detection){
					//进行编码
					gcmc_c = encodeURI(encodeURI(gcmc));
					constr = encodeURI(encodeURI(construction));
					supvision = encodeURI(encodeURI(supervision));
					detect = encodeURI(encodeURI(detection));
					var zhuyi="本月已完成项第三方检测";
					var chakan="本月已完成项项目自检";
					
					var diqu="地区："+	dq;
					var an1='点击查看';
					var an2='人员签到';
					var an3='进入工程';
				
					
					var gongcheng=document.getElementById("gongcheng");
					//创建初级div
					var div = document.createElement("div");
					div.className = "mui-table-view my_list mui-card margintop10px";
					div.style = "margin-top: 10px";
					div.id="div"+id+"num"+i;
					
					//创建次级div_2
					var muicontent=document.getElementsByClassName('mui-content');
						var div=document.createElement('div');
						div.className='mui-card margintop10px';			
						gongcheng.appendChild(div);
						var ul=document.createElement('ul');//创建ul
						ul.className='mui-table-view my_list';
						div.appendChild(ul);
						var li=document.createElement('li');//创建第一个li
						li.className='mui-table-view-cell mui-media my_backgroundcolor_blue my_color_white';
						ul.appendChild(li);
						var a=document.createElement('a');//	
						a.href="my_project.html?id="+id+"&gcmc="+gcmc_c+"&timestamp="+timestamp+"&constr="+constr+"&supvision="+supvision+"&detect="+detect;
						li.appendChild(a);
						var img=document.createElement('img');
						img.className='mui-media-object mui-pull-right';
						img.src='../images/xmmc.png';
						a.appendChild(img);
						var div2=document.createElement('div');
						div2.className='mui-media-body';			
						a.appendChild(div2);
						var txt=document.createTextNode(gcmc);//工程名称
						div2.appendChild(txt);
						var p=document.createElement('p');
						p.className='mui-ellipsis my_color_white';
						div2.appendChild(p);
						var txt2=document.createTextNode(diqu);//地区：地区名称
						p.appendChild(txt2);
						var p2=document.createElement('p');
						p2.className='mui-ellipsis my_underline my_color_white';
						div2.appendChild(p2);
						var txt3=document.createTextNode(an3);//进入工程
						p2.appendChild(txt3);
						/*蓝色头部完成*/
						//第二个li
						var li2=document.createElement('li');//创建第二个li
						li2.className='mui-table-view-cell mui-media';
						ul.appendChild(li2);
						var a2=document.createElement('a');//创建第三个a
						li2.appendChild(a2);
						var div3=document.createElement('div');
						div3.className='mui-media-body';
						a2.appendChild(div3);
						var span=document.createElement('span');//创建span
						span.className='mui-icon mui-icon-spinner-cycle mui-pull-left';
						div3.appendChild(span);
						var button=document.createElement('button');//创建button
						button.id="ck"+id;
						button.className='mui-btn mui-btn-warning mui-pull-right';
						button.type='button';
						div3.appendChild(button);
						var txt4=document.createTextNode(an1);
						button.appendChild(txt4);
						var p3=document.createElement('p');
						p3.className='mui-ellipsis my_fontsize my_color_blue my_paddingleft';
						div3.appendChild(p3);
						var txt5=document.createTextNode(zhuyi);
						p3.appendChild(txt5);
						
						//第三个a标签
						var li3=document.createElement('li');//创建第二个li
						li3.className='mui-table-view-cell mui-media';
						ul.appendChild(li3);
						var a3=document.createElement('a');//创建第三个a
						li3.appendChild(a3);
						var div4=document.createElement('div');
						div4.className='mui-media-body';
						a3.appendChild(div4);
						var span=document.createElement('span');//创建span
						span.className='mui-icon mui-icon-spinner-cycle mui-pull-left';
						div4.appendChild(span);
						var button=document.createElement('button');//创建button
						button.id="ck"+id;
						button.className='mui-btn mui-btn-warning mui-pull-right';
						button.type='button';
						div4.appendChild(button);
						var txt4=document.createTextNode(an1);
						button.appendChild(txt4);
						var p4=document.createElement('p');
						p4.className='mui-ellipsis my_fontsize my_color_blue my_paddingleft';
						div4.appendChild(p4);
						var txt6=document.createTextNode(chakan);
						p4.appendChild(txt6);
				}
				
				//异步传值
				mui.ajax(url+'my_plus/my_project_list.php',{
					data:{
						uid:uid
					},
					dataType:'json',
					type:'POST', 
					timeout:10000,
					success:function(data){

						var length=data.length;
						if (length>=1) {
							for (var i=0;i<length;i++) {
								var id = data[i].id;
								var timestamp = data[i].时间戳;
								var gcmc = data[i].工程名称;
								var dq = data[i].地址;
								var construction = data[i].施工单位;
								var supervision = data[i].监理单位;
								var detection = data[i].检测单位;
								myproject(id,timestamp,gcmc,dq,i,construction,supervision,detection);
							}
						}else{
//							alert("暂无数据");
						}
					},
					error:function(xhr,type,errorThrown){
//						alert('ajax错误'+type+'---'+errorThrown+"失败！");
					}
				});
			});
			//返回父页面刷新
			function back(){
				var target=plus.webview.getWebviewById('my.html');
				target.reload(true);
				mui.back();
			}
		</script>
	</body>

</html>