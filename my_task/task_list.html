<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/my_css.css">
		<link rel="stylesheet" href="../css/my_project_fhys_xz.css" />
		<link rel="stylesheet" href="../css/mui.picker.min.css"/>
		<link rel="stylesheet" href="../css/mui.poppicker.css"/>
		<style>
			#reinspection{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:9%;
			}
			#consigncode{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:9%;
			}
			#zuyPopover{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:9%;

			}
			#recPopover{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
			#inspect1_code{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
			#inspect2_code{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
			#commissionNum{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
			#commission_code{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
			#commissionNum2{
				min-width: 300px;
				height:150px;				
				top:35%;
				/*position:relative;*/
				left:8%;
			}
		</style>
	</head>

	<body>
	    <header class="mui-bar mui-bar-nav">
	        <a class="mui-icon mui-icon-left-nav mui-pull-left" onclick="back()"></a>
	        <h1 id="refresh" class="mui-title">任务列表</h1>
	    </header>
	    <div class="mui-content">
	   		<div style="padding: 10px 10px;">
				<div id="segmentedControl" class="mui-segmented-control">
					<div class="mui-slider">
		       			<div id="xuanxiangka" class="mui-slider-group mui-slider-loop ">
		        		   	<!--<div class="mui-slider-item">
		         		        <a id="a4" class="mui-control-item  "  href="#item4">
									实体检测
								</a>
								<a id="a5" class="mui-control-item"  href="#item5">
									材料抽检
								</a>
								<a id="a6" class="mui-control-item"  href="#item6">
									实体抽检
								</a>
								<a class=" mui-icon mui-icon-arrowleft mui-pull-left" style="bottom: 18px;"></a>
		         		    </div>-->
		         		    <div class="mui-slider-item">
								<a id="a1" class="mui-control-item  mui-active" href="#item1">
									材料送检(0)
								</a>
								<a id="a2" class="mui-control-item"  href="#item2">
									材料自检(0)
								</a>
								<a id="a3" class="mui-control-item"  href="#item3">
									实体自检(0)
								</a>
								<a id="a4" class="mui-control-item  "  href="#item4">
									实体检测(0)
								</a>
								<!--<a class=" mui-icon mui-icon-arrowright mui-pull-right" style="bottom: 18px;"></a>-->
	         		   	    </div>
		      		  	</div>
		   			</div>
				</div> 
			</div>
			<!----------------------材料送检 ------------------------->
			<div id="item1" class="mui-control-content  mui-active">
			    <div id="scroll" class="mui-scroll-wrapper">
			    	<div id="send" class="mui-scroll rwdiv">

					</div>
			    </div>
			</div>
			<!--验证码-->
			<div id="zuyPopover" class="mui-popover">
        		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
        		<form class="mui-input-group" style="margin-top: 15px;">
        			<div class="mui-input-row">
        				<label>验证码:</label>
        				<input id="code1" type="number" class="mui-input-clear" placeholder="输入验证码" value="">
        			</div>    			
        		</form>
				<div id="comfirm"  class="mui-button-row my_margintop10px">
					<button   type="button" class="mui-btn mui-btn-primary" onclick="qdjz(this)">确定</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="sendMsg" type="button" class="mui-btn mui-btn-primary" onclick="time(this)">获取验证码</button>
				</div>
			</div>
			<!--复检验证码-->
			<div id="recPopover" class="mui-popover">
        		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
        		<form class="mui-input-group" style="margin-top: 15px;">
        			<div class="mui-input-row">
        				<label >验证码:</label>
        				<input id="code_recheck" type="number" class="mui-input-clear" placeholder="输入验证码" value="" >
        			</div>    			
        		</form>
				<div id="recheck"  class="mui-button-row my_margintop10px">
					<button   type="button" class="mui-btn mui-btn-primary" onclick="recheck(this)">确定</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="sendMsg" type="button" class="mui-btn mui-btn-primary" onclick="time(this)">获取验证码</button>
				</div>
			</div>
			<!--复检验证码-->
			<form class="mui-input-group my_none">
			    <div class="mui-input-row my_none">
			        <label>企业ID</label>
			        <input name="CorpID"  type="text" id="CorpID" class="mui-input-clear" value="101781">
			    </div>
			    <div class="mui-input-row my_none">
			        <label>登录名</label>
			        <input name="LoginName" type="text" id="LoginName" class="mui-input-clear" value="Admin">
			    </div>
			    <div class="mui-input-row  my_none">
			        <label>密码</label>
			        <input name="pwd" type="text" id="pwd" class="mui-input-clear" value="174012" >
			    </div>
			    <div class="mui-input-row  my_none">
			        <label>服务器地址</label>
			        <input name="serverIP" type="text" id="serverIP" class="mui-input-clear"  value="http://sms.mobset.com:8080/Api?wsdl">
			    </div>
			    <div class="mui-input-row  my_none">
			        <label>手机号码</label>
			        <input name="mobPhone" type="text" id="mobPhone" class="mui-input-clear"  >
			    </div>
			    <div class="mui-input-row  my_none">
			        <label>短信内容</label>
			        <input name="smsContent" type="text" id="smsContent" class="mui-input-clear" value="验证码：">
			    </div>
			     <div class="mui-input-row  my_none">
			        <label>验证码</label>
			        <input name="yzm" type="text" id="yzm" class="mui-input-clear" >
			    </div>
			</form>
			<!--验证码-->
			<!--检测报告编号-->
			<div id="consigncode" class="mui-popover">
	    		<h4 id="title" style="text-align: center;margin-top: 15px;">合格</h4>
	    		<form class="mui-input-group" style="margin-top: 15px;" id="concode">
	    			<div class="mui-input-row">
	    				<label>检测报告编号:</label>
	    				<input id="testNum" type="number" class="mui-input-clear" placeholder="输入检测报告编号">
	    			</div>    			
	    		</form>
				<div id="code_act"  class="mui-button-row my_margintop10px">
					<button id="code_close"  type="button" class="mui-btn mui-btn-primary mui-action-back" >取消</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="code_sure" type="button" class="mui-btn mui-btn-primary" onclick="inpcode(this)">确认</button>
				</div>
			</div>
			<!--复检编号-->
			<div id="reinspection" class="mui-popover">
	    		<h4 id="title" style="text-align: center;margin-top: 15px;">合格</h4>
	    		<form class="mui-input-group" style="margin-top: 15px;" id="concode">
	    			<div class="mui-input-row">
	    				<label>检测报告编号:</label>
	    				<input id="recheckNum" type="number" class="mui-input-clear" placeholder="输入检测报告编号">
	    			</div>    			
	    		</form>
				<div id="code_act1"  class="mui-button-row my_margintop10px">
					<button id=""  type="button" class="mui-btn mui-btn-primary mui-action-back" >取消</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="" type="button" class="mui-btn mui-btn-primary" onclick="recheckNum(this)">确认</button>
				</div>
			</div>
			<!--检测报告编号-->
			<!----------------------材料送检 ------------------------->
			
			<!----------------------材料自检 ------------------------->
			<div id="item2" class="mui-control-content  ">
			    <div id="scroll" class="mui-scroll-wrapper">
			    	<div id="self_inspection1" class="mui-scroll rwdiv">

					</div>
			    </div>
			</div>
			<!--验证码-->
			<div id="inspect1_code" class="mui-popover">
        		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
        		<form class="mui-input-group" style="margin-top: 15px;">
        			<div class="mui-input-row">
        				<label>验证码:</label>
        				<input id="code2" type="number" class="mui-input-clear" placeholder="输入验证码" value="">
        			</div>    			
        		</form>
				<div id="insConfirm1"  class="mui-button-row my_margintop10px">
					<button   type="button" class="mui-btn mui-btn-primary" onclick="insp_code1(this)">确定</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="sendMsg" type="button" class="mui-btn mui-btn-primary" onclick="time(this)">获取验证码</button>
				</div>
			</div>
			<!----------------------材料自检 ------------------------->
			
			<!----------------------实体自检 ------------------------->
			<div id="item3" class="mui-control-content  ">
			    <div id="scroll" class="mui-scroll-wrapper">
			    	<div id="self_inspection2" class="mui-scroll rwdiv">

					</div>
			    </div>
			</div>
			<!--验证码-->
			<div id="inspect2_code" class="mui-popover">
        		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
        		<form class="mui-input-group" style="margin-top: 15px;">
        			<div class="mui-input-row">
        				<label>验证码:</label>
        				<input id="code3" type="number" class="mui-input-clear" placeholder="输入验证码" value="">
        			</div>    			
        		</form>
				<div id="insConfirm2"  class="mui-button-row my_margintop10px">
					<button   type="button" class="mui-btn mui-btn-primary" onclick="insp_code2(this)">确定</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="sendMsg" type="button" class="mui-btn mui-btn-primary" onclick="time(this)">获取验证码</button>
				</div>
			</div>
			<!----------------------实体自检 ------------------------->
			
			<!----------------------实体检测 ------------------------->
			<div id="item4" class="mui-control-content  ">
			    <div id="scroll" class="mui-scroll-wrapper">
			    	<div id="commission" class="mui-scroll rwdiv">

					</div>
			    </div>
			</div>
			<!--委托编号-->
			<div id="commissionNum" class="mui-popover">
	    		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
	    		<form class="mui-input-group" style="margin-top: 15px;" id="concode">
	    			<div class="mui-input-row">
	    				<label>委托编号:</label>
	    				<input id="code_input" type="number" class="mui-input-clear" placeholder="输入委托编号">
	    			</div>    			
	    		</form>
				<div id="code_act2"  class="mui-button-row my_margintop10px">
					<button id="code_close"  type="button" class="mui-btn mui-btn-primary mui-action-back" >取消</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="code_sure" type="button" class="mui-btn mui-btn-primary" onclick="comcode(this)">确认</button>
				</div>
			</div>
			<!--委托编号-->
			<!--验证码-->
			<div id="commission_code" class="mui-popover">
        		<h4 id="title" style="text-align: center;margin-top: 15px;">确定见证</h4>
        		<form class="mui-input-group" style="margin-top: 15px;">
        			<div class="mui-input-row">
        				<label>验证码:</label>
        				<input id="code4" type="number" class="mui-input-clear" placeholder="输入验证码" value="">
        			</div>    			
        		</form>
				<div id="comConfirm"  class="mui-button-row my_margintop10px">
					<button   type="button" class="mui-btn mui-btn-primary" onclick="comyzm(this)">确定</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="sendMsg" type="button" class="mui-btn mui-btn-primary" onclick="time(this)">获取验证码</button>
				</div>
			</div>
			<!--检测报告编号-->
			<div id="commissionNum2" class="mui-popover">
	    		<h4 id="title" style="text-align: center;margin-top: 15px;">合格</h4>
	    		<form class="mui-input-group" style="margin-top: 15px;" id="concode1">
	    			<div class="mui-input-row">
	    				<label>检测报告编号:</label>
	    				<input id="comNum" type="number" class="mui-input-clear" placeholder="输入检测报告编号">
	    			</div>    			
	    		</form>
				<div id="frame"  class="mui-button-row my_margintop10px">
					<button id="code_close"  type="button" class="mui-btn mui-btn-primary mui-action-back" >取消</button>					
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="code_sure" type="button" class="mui-btn mui-btn-primary" onclick="testcode(this)">确认</button>
				</div>
			</div>
			<!----------------------实体检测 ------------------------->
	    </div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/service.js"></script>
		<script src="send.js"></script><!--材料送检-->
		<script src="self_inspection1.js"></script><!--材料自检-->
		<script src="self_inspection2.js"></script><!--实体自检-->
		<script src="commission.js"></script><!--实体检测-->
		<script type="text/javascript">
			mui.init({
				gestureConfig:{					
					longtap: true, //长按默认为false	
					doubletap: true
				}
			});
			var refresh = document.getElementById("refresh");
			//监听标题栏的双击事件(刷新页面)
			refresh.addEventListener('doubletap',function () {
				window.location.reload();
			});
			function plusReady(){
				// 弹出系统等待对话框
				plus.nativeUI.showWaiting( "正在拼命加载中..." );
				setTimeout( function(){
					plus.nativeUI.closeWaiting();
				}, 1500 );
			}
			if(window.plus){
				plusReady();
			}else{
				document.addEventListener("plusready",plusReady,false);
			}
			//区域滚动,需手动初始化scroll控件
			mui('.mui-scroll-wrapper').scroll({
				deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
			});
			mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				uid = self.uid;//用户id
				mobile = self.mobile;//手机号
				my_name = self.my_name;//姓名
				unit = self.unit;//单位
				unitName = self.unitName; //单位名称
				my_name = decodeURI(decodeURI(my_name));
				unit = decodeURI(decodeURI(unit));
				
				mui.ajax(url+'my_task/task_list.php',{
					data:{
						flag:'获取工程时间戳',
						uid:uid
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					success:function(data){
						var length = data.length;
						for(var i=0;i<length;i++){
							var pj_timestamp = data[i].时间戳;
							taskList1(pj_timestamp);//材料送检
							taskList2(pj_timestamp);//材料自检
							taskList3(pj_timestamp);//实体自检
							taskList4(pj_timestamp);//实体检测
						}
					},
					error:function(xhr,type,errorThrown){
//						alert('ajax错误'+type+'---'+errorThrown+"失败！");
					}
				});
			});
			
			//验证码监听
			var wait = 60;
			function time(o){
				 if (wait == 0) {  
		            o.removeAttribute("disabled");            
		            o.innerHTML="获取验证码";  
		            wait = 60;  
		        }else{
		        	if(wait == 60){
		        		//短信发送
						var sendMsg = document.getElementById("sendMsg");
						var CorpID = document.getElementById("CorpID");
						var LoginName = document.getElementById("LoginName");
						var pwd = document.getElementById("pwd");
						var serverIP = document.getElementById("serverIP");
						var mobPhone = document.getElementById("mobPhone");
						var smsContent = document.getElementById("smsContent");
						mobPhone.value = mobile;
						yzm = document.getElementById("yzm");
						mui.ajax(url+'send_Sms/SendSms.php',{
							data:{
								CorpID:CorpID.value,
								LoginName:LoginName.value,
								pwd:pwd.value,
								serverIP:serverIP.value,
								mobPhone:mobPhone.value,
								smsContent:smsContent.value
							},
							dataType:'json',
							type:'POST', 
							timeout:10000,
							success:function(data){
								if(data.result=='success'){
		//									alert(data.smsContent);
									yzm.value = data.yzm; //获取验证码数字
								}
							},
							error:function(xhr,type,errorThrown){
								alert('ajax错误'+type+'---'+errorThrown);
							}
						});
		        	}
		            o.setAttribute("disabled", true);  
		            o.innerHTML="重新发送(" + wait + ")";  
		            wait--;  
		            setTimeout(function() {  
		                time(o)  
		            },1000)  
		        }  
			}
			//返回父页面刷新
			function back(){
				var target=plus.webview.getWebviewById('my.html');
				target.reload(true);
				mui.back();
			}
		</script>
	</body>

</html>